#!/usr/bin/env ruby
# YAML structure defining a SAX xml parsing scheme/fmp-grammar.
---
elements:
  fmresultset:
    class: Rfm::FmResultset
    hide: true
    elements:
      datasource:
        class: Rfm::Datasource
      metadata:
        class: Rfm::Meta
        elements:
          field_definition:
      resultset:
        #allocate: true
        # This is evaluated from the cursor point of view.
        # It gives the top object, which should be the Rfm::Connection instance.
        initialize_with: _top._obj
        class: Rfm::Resultset
        individual_attributes: true
        before_close: :attach_parent_objects
        elements:
          record:
            allocate: true
            class: Rfm::Record
            hide_attributes: true
            individual_attributes: true
            #initialize_with: _obj
            elements:
              field:
                allocate: true
                class: Rfm::Metadata::Field
                compact: true
                hide: true
                before_close: :build_record_data
              relatedset:
                allocate: true
                class: Rfm::RelatedSet
                as_attribute: portals
                delineate_with_hash: table
                elements:
                  record:
                    allocate: true
                    class: Rfm::Record
                    hide_attributes: true
                    elements:
                      field:
                        compact: true
                        allocate: true
                        class: Rfm::Metadata::Field
                        hide: true
                        before_close: :build_record_data
